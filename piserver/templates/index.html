<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN">
<html  lang="en">
<head>
	 <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no user-scalable=0 ">

	<title>Pi Control Panel .demo</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/dropdowns-enhancement.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/button.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/head.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/zico.css') }}">
<script src="{{ url_for('static', filename='js/jquery-min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/popper.js') }}"></script>
<script src="{{ url_for('static', filename='js/zico.js') }}"></script>
<script src="{{ url_for('static', filename='js/vue.js') }}"></script>
<script src="{{ url_for('static', filename='js/axios.js') }}"></script>

</head>
<body>
  {% raw %}
  <div class="container-fluid " id="app">
    <!--顶部菜单-->
    <div class="row">
      <div class="col-12">
      <nav class="navbar navbar-dark navbar-fixed-top bg-dark navbar-expand-lg col-12">
        <a class="navbar-brand" href="#"><span class="zi zi_batteryquarter "></span> Pi Control Panel .demo</a>
      </nav>
    </div>
    </div>
  
  
    <div class="row">
  <table class="table table-bordered table-responsive　col-12">
  
  <tr>
    <td> 
        <div class="btn-group btn-group-sm border border-secondary rounded">
        <button type="button" class="btn btn-light ">
        <b>温度[℃]:</b> <span class="badge badge-secondary">100.00</span>
        <span class="badge badge-secondary">100.00</span>
        <span class="badge badge-secondary">100.00</span>
        </button>
        </div>
        <div class="btn-group btn-group-sm"> 　
        <button type="submit" class="btn btn-outline-info  " onclick="window.location.href = '/cp'">設定初期化</button>
        </div>
    </td>
  
    </tr>
  
  <tr>	
    <td>
  <!-- 输出结果 pre代码块 -->
  <div>
  <pre  class="pre-scrollable col-xs-12 col-md-7 text-justify border border-secondary bg-light rounded" id="outputTerminal">
GPIO初期化完了 LED0点灯 gpio17==high 
LED0==True
    
  
  
  </pre>  <!-- 维持宽度需要至少4行输出 -->

  </div>
  
  <!-- LED0和全部停止 -->
  <div class=" ">  
      <div class="btn-group btn-group-sm">
        <div class="input-group-prepend ">
        <div class="input-group-text ">LED0</div>
        </div>
        <button  class="btn btn-outline-success btn-sm " id="turnonLED0">ON</button>
        <button  class="btn btn-outline-secondary btn-sm " id="turnoffLED0">OFF</button>
      </div>
      <div class="btn-group ">
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <button id="stop"class="btn btn-outline-danger " data-toggle="modal" data-target="#stopAll" >全停止</button>
      </div>
      <!-- Modal -->
  <div class="modal fade" id="stopAll" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">确定要全部停止吗？</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          马达，加热器将全部停止，LED0恢复初始。
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-danger">确认</button>
        </div>
      </div>
    </div>
  </div>
  </div>
  
  </td>  
  </tr>
  
  <tr>
  <td >
  <!-- 折叠选项卡 -->
  <div>
    <ul class="nav nav-tabs" >
      <li class="nav-item">
        <a :class="tabMotorIsActive "  @click="showMotor" href="#">モータ</a>
      </li>
      <li class="nav-item">
        <a :class="tabTempIsActive "  @click="showTemp" href="#">温度</a>
      </li>
      <li class="nav-item"></li>
        <a :class="tabSetupIsActive" href="#">設定</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
  <!-- {{ message }} -->
  <!-- <button @mouseup="warn1" @mousedown="warn2" class="btn btn-outline-dark btn-sm">Test</button> -->
  
  <!-- 马达折叠内容 -->
  <p>
  <div class="" v-if="isShowMotorTabContent ">
    

    Timer<br>
    <div  class="btn-group btn-group-lg  "> 
      <button v-if="isShowdcw" class="btn btn-outline-info btn-sm" id="dcw" @click="btndcw">左 </button> 
      <button v-if="isShowdccw" class="btn btn-outline-info " id="dccw" @click="btndccw">右</button>
      
      <!-- <button  @mousedown="btnmotordcwdown" @mouseup="btnmotordcwup" class="btn btn-outline-dark btn-sm "><</button> -->
      <div id="Tdirection" class="input-group-text" style="width:90px;">{{Td}}s</div> 
    <!--   <button @mousedown="btnmotordccwdown" @mouseup="btnmotordccwup" class="btn btn-outline-dark btn-sm ">></button> -->
      <button  @click="treset" class="btn btn-outline-dark btn-lg" >0</button>
      
    </div>

    <div  class="btn-group btn-group-lg" > 
     <!-- <span class="zi zi_pulse zi_copyright m-1 "></span> -->
      <button v-if="isShowd1" @click="d1"  class=" btn btn-outline-dark  btn-lg" :disabled="isDisd1" >左</button>
      <button v-if="isShowd2" @click="d2" class="btn btn-outline-dark btn-lg" :disabled="isDisd1" >右</button>
      <button v-if="isShowmstp" @click="motorstop" id="motorstop"class="btn btn-outline-secondary btn-lg zi zi_clock" > 停止</button>
      <button v-if="isShowmon" @click="motoron" class="btn btn-outline-success btn-lg zi zi_clock" > 回転</button>


      
    </div>

    <div style="height:2px;">  </div>
    Control<br>
    <div  class="btn-group " > 
     <!-- <span class="zi zi_pulse zi_copyright m-1 "></span> -->
      <button id="motord1" class=" btn btn-outline-success  btn" >正転</button>
      <button  id="motorstop"class="btn btn-outline-secondary btn" >停止</button>
      <button  id="motord2"class="btn btn-outline-success btn"  >逆転</button>
    </div>

    <div style="height:5px;">  </div>

      



    
    <div >Auto Run </div>
    <div style="font-size:10px;">(入力ボックスをダブルクリックでタイマーをコピーできる)</div>
    <div class="  "  autocomplete="on" >
      <div>
        <input type="button"  class="btn btn-info btn-sm" id="motorautorun" value="自動運転開始">
        <input type="button" class="btn btn-info btn-sm" id="motorautostop" value="停止(未完成)" disabled="on">
      </div>
      <div style="height:5px;">  </div>
      <div class="input-group input-group-prepend ">
        <div class="" style="width: 26px;"></div>
        <div class="input-group-text" style="width: 100px;" >正転</div>
        <span class="input-group-text" style="width: 100px;" >逆転</span>
        <div class="input-group-text" style="width: 70px;" >停止</div>
        <button class="btn btn-outline-primary btn-sm ">+</button>
      </div>
     
      <!-- 渲染列表 -->
      <div v-for="(item,index) in timelist " class="input-group-addon  input-group-prepend    ">
        <button class="btn btn-outline-dark btn-sm"  > × </button>
        <input style="width: 100px;" @dblclick="copytcw(index)" v-model="item.cw" type="number" step="0.001" class="form-control "  min="0" placeholder="秒/S" autocomplete="on" required >
        <input style="width: 100px;" @dblclick="copytccw(index)" v-model="item.ccw" type="number" step="0.001" class="form-control "  min="0" placeholder="秒/S" autocomplete="on" required >
        <input style="width: 70px;"  type="number"  v-model="item.stp" step="0.001"class="form-control "   min="0" placeholder="秒/S" autocomplete="on" required>
        <span  @click="changetime(index)" class="btn btn-outline-dark  zi zi_exchangealt "></span>
        
        <button @click="motorrun(index)" class="btn btn-outline-success  zi zi_play "></button>
      </div> 
      <!-- 渲染列表结束 -->
      <!-- <div  v-show="onfocus">
        <div class="btn-group btn-group-sm">
          <span style="width: 30px;"></span>
          <button class="btn btn-outline-dark" style="width: 100px;">Copy</button>
          <button class="btn btn-outline-dark" style="width: 100px;">Copy</button>
          <span class="btn btn-outline-dark  zi zi_exchangealt"></span>

        </div>
      </div> -->



      <div class="input-group-prepend    ">
        <div class="input-group-text">CwT1&nbsp&nbsp&nbsp</div>
        <input style="width: 75px;" type="number" step="0.1" class="form-control " id="motorrunningT1" min="0" placeholder="秒/S" value="1" autocomplete="on" required >
        <div class="input-group-text">StopT2</div>
        <input style="width: 75px;" type="number"   step="0.1"class="form-control " id="motorwaitingT2"  min="0" placeholder="秒/S" value="2" autocomplete="on" required>
      </div> 
  
      <div class="input-group col-xs-12 ">
        <div class="input-group-text">CwT3 &nbsp&nbsp</div>
        <input style="width: 75px;" type="number"   step="0.1" class="form-control" id="motorrunningT3" min="0"  placeholder="秒/S" value="1" autocomplete="on" required>
        <div class="input-group-addon">StopT4</div>
        <input style="width: 75px;" type="number"   step="0.1" class="form-control" id="motorwaitingT4" min="0"  placeholder="秒/S" value="2"  autocomplete="on" required>
      </div>
  
      <div class="input-group col-xs-12">
        <div class="input-group-text">CcwT5</div>
        <input style="width: 75px;" type="number"   step="0.1"class="form-control" id="motorrunningT5" min="0"  placeholder="秒/S"  value="1"  autocomplete="on" required>
        <div class="input-group-addon">StopT6</div>
        <input style="width: 75px;" type="number"   step="0.1" class="form-control" id="motorwaitingT6"  min="0" placeholder="秒/S" value="2" autocomplete="on"  required>
      </div>
  
      <div class="input-group col-xs-12">
        <div class="input-group-text ">CcwT7</div>
        <input style="width: 75px;" type="number"   step="0.1"class="form-control" id="motorrunningT7" min="0"  placeholder="秒/S" value="1"  autocomplete="on"  required>
        <div class="input-group-addon">StopT8</div>
        <input style="width: 75px;" type="number"   step="0.1" class="form-control" id="motorwaitingT8" min="0"  placeholder="秒/S" value="2"  autocomplete="on" required>
      </div>
  
    </div>
  </div>
  </p>
  
  <!-- 温度折叠内容 -->
  <p>
  <div v-if="isShowTempTabContent" >
  温度折叠 
  
  </div>
  </p>
  
  </td> 
  </tr>
   
  
  </table>
  
  
  </div> 
  <!-- 表格row -->
  
  <!-- container fluid -->
  </div>
{% endraw %}
  
  
  
  <script>
    var app=new Vue({
      el:"#app",
      data:{
        isShowMotorTabContent:true,
        tabMotorIsActive:{ 'nav-link':true, 'active':true,},
        isShowTempTabContent:false,
        tabTempIsActive:{ 'nav-link':true, 'active':false,},
        isShowSetupTabContent:false,
        tabSetupIsActive:{ 'nav-link':true, 'disabled':true,},
        // 马达正反计算时间按钮 Timer部分
        isShowd1:true,
        isShowd2:false,
        isShowmstp:false,
        isShowmon:true,
        isDisd1:false,
        isDisd2:false,
        isShowdccw:true,
        isShowdcw:false,
        Tdirection:"0.0",
        msdowncw:"0",
        msupcw:"0",
        tcw:"0",
        msupccw:"0",
        msdownccw:"0",
        tccw:"0",
        Td:"000.000",
        mson:"0",
        msstp:"0",
        msmon:"0",
        onfocus:false,
        timecw:"001.005",
        timeccw:"0",
        timestp:"1.5",
        
        timelist:[
          {cw:"001.005",ccw:0,stp:1},
          {cw:0,ccw:1,stp:1.5},
          {cw:1.5,ccw:1.5,stp:0},
          {cw:1,ccw:1,stp:1},
        ],
        

        
 
        


      },
      //标签fen
      methods:{
        showMotor:function(){
          this.isShowMotorTabContent = true;
          this.isShowTempTabContent=false;
          this.isShowSetupTabContent=false;
          this.tabMotorIsActive.active=true;
          this.tabTempIsActive.active=false;
          this.tabSetupIsActive.active=false;
        },
        showTemp:function(){
          this.isShowMotorTabContent = false;
          this.isShowTempTabContent=true;
          this.isShowSetupTabContent=false;
          this.tabMotorIsActive.active=false;
          this.tabTempIsActive.active=true;
          this.tabSetupIsActive.active=false;
        },
        // 马达计正反计算时间按钮
        btndcw:function(){
          this.isShowdcw=false;
          this.isShowdccw=true;
        },
        btndccw:function(){
          this.isShowdcw=true;
          this.isShowdccw=false;
        },
        btndcw1:function(){
          this.isShowdcw1=false;
          this.isShowbtnstpcw1=true;
        },
        btndccw1:function(){
          this.isShowccw1=false;
          this.isShowbtnstpccw1=true;
        },
        // btnmotordcwdown:function(){ //按下马达左转，按钮左  //这4个方法方向有问题
        //   now=new Date();
        //   this.msdowncw=now.valueOf();
        //   // output="msdowncw "+this.msdowncw;
        //   console.log("msdowncw "+this.msdowncw)
  
        // },
        // btnmotordcwup:function(){ //抬起马达左转
        //   now=new Date();
        //   this.msupcw=now.valueOf()
        //   console.log("msupcw "+this.msupcw)
        //   this.tcw=this.msupcw-this.msdowncw;
        //   console.log("tcw "+this.tcw)
        //   if (this.isShowdcw==true && (this.tcw-this.tccw)!=0){
        //     this.Tdirection=(this.tcw-this.tccw+Number(this.Tdirection));
        //     this.Td=this.Tdirection/1000;
        //     console.log("if1 Tdirection "+this.Tdirection)
        //     this.Td=(this.Tdirection/1000).toFixed(1);
        //   };
        //   if (this.isShowdccw==true && (this.tccw-this.tcw)!=0){
        //     this.Tdirection=(this.tccw-this.tcw+Number(this.Tdirection))
        //     this.Td=(this.Tdirection/1000).toFixed(1);
        //     console.log("if2 Tdirection "+this.Tdirection);
        //   };
        // },
        // btnmotordccwdown:function(){ //按下马达右转,按钮右
        //   now=new Date();
        //   this.msdownccw=now.valueOf();
        // },
        // btnmotordccwup:function(){ //抬起马达右转
        //   now=new Date();
        //   this.msupccw=now.valueOf()
        //   console.log("msupccw "+this.msupccw)
        //   this.tccw=this.msupccw-this.msdownccw;
        //   console.log("tccw "+this.tccw)
        //   if (this.isShowdcw==true && (this.tcw-this.tccw)!=0){
        //     this.Tdirection=(this.tcw-this.tccw+Number(this.Tdirection));
        //     console.log("if1 Tdirection "+this.Tdirection)
        //     this.Td=(this.Tdirection/1000).toFixed(1);
        //   };
        //   if (this.isShowdccw==true && (this.tccw-this.tcw)!=0){
        //     this.Tdirection=(this.tccw-this.tcw+Number(this.Tdirection))
        //     this.Td=(this.Tdirection/1000).toFixed(1);
        //     console.log("if2 Tdirection "+this.Tdirection);
        //   };
          
        // },
        d1:function(){
          this.isShowd1=false
          this.isShowd2=true
        },
        d2:function(){
          this.isShowd1=true
          this.isShowd2=false
        },
        motorstop:function(){
          this.isShowmon=true
          this.isShowmstp=false
          this.isDisd1=false
          this.isDisd2=false
          now=new Date();
          this.msstp=now.valueOf();
          this.msmon=this.msstp-this.mson;
          if(this.isShowd1==true){
            this.tcw=this.msmon;
            console.log("tcw "+this.tcw)
          };
          if(this.isShowd2==true){
            this.tccw=this.msmon
            console.log("tcww "+this.tccw)
          }
          axios
            .post('/cp/motorstop')
            .then(response => (this.info = response))
            .catch(function (error) { // 请求失败处理
            console.log(error);
            });
          if (this.isShowdcw==true && (this.tcw-this.tccw)!=0){
            this.Tdirection=(this.tcw-this.tccw+Number(this.Tdirection));
            this.Td=this.Tdirection/1000;
            console.log("if1 Tdirection "+this.Tdirection)
            this.Td=(this.Tdirection/1000).toFixed(3);
            this.tccw=0
            this.tcw=0
          };
          if (this.isShowdccw==true && (this.tccw-this.tcw)!=0){
            this.Tdirection=(this.tccw-this.tcw+Number(this.Tdirection))
            this.Td=(this.Tdirection/1000).toFixed(3);
            console.log("if2 Tdirection "+this.Tdirection);
            this.tccw=0
            this.tcw=0
          };

        },
        motoron:function(){
          this.isShowmon=false
          this.isShowmstp=true
          this.isDisd1=true
          this.isDisd2=true
          now=new Date();
          this.mson=now.valueOf();
          if(this.isShowd1==true){
            axios
            .post('/cp/motord1')
            .then(response => (this.info = response))
            .catch(function (error) { // 请求失败处理
              console.log(error);
             });
            };
          if(this.isShowd2==true){
          axios
          .post('/cp/motord2')
          .then(response => (this.info = response))
          .catch(function (error) { // 请求失败处理
            console.log(error);
            });
          };
        },
        treset:function(){
          this.Tdirection="0"
          this.Td=0.0
          this.tccw=0
          this.tcw=0
          this.msmon=0
        },

        //参数设置
        copytcw:function(index){
          this.timelist[index].cw=this.Td
          console.log("双击方法")
        },
        copytccw:function(index){
          this.timelist[index].ccw=this.Td
          console.log("双击方法")
        },
        changetime:function(index){
          tcw=this.timelist[index].cw
          tccw=this.timelist[index].ccw
          this.timelist[index].cw=tccw
          this.timelist[index].ccw=tcw

        },

        //马达运行
        motorrun:function(index){
          tcw=this.timelist[index].cw
          tccw=this.timelist[index].ccw
          tstp=this.timelist[index].stp
          console.log("tcw: "+tcw)
          console.log("tccw: "+tccw)
          console.log("tstp: "+tstp)
          axios
            .post('/cp/motorrun',{
              "cw":tcw,
              "ccw":tccw,
              "stp":tstp,
 
            })
            .then(function(response){
              console.log(response.data)
            })
            .catch(function (error) { // 请求失败处理
              console.log(error);
             });

        },




        focus:function(){
          this.onfocus=true
        },
        blur:function(){
          this.onfocus=false;
        },

        warn1:function(){
          this.showMotor();
        },
        warn2:function(){
          this.showTemp();
        }

    } })
      

  //测试脚本，测试id==bt1,路由==test	
  $(document).ready(function(){
    $("#bt1").click(function(){
      $.post("/cp/test",{},function(data,status){
        // alert("数据：" + data + "\n状态：" + status);
         $("#outputTerminal").text("方法：" + data + "状态：" + status);
      });
    });
  });
  
  
  
  //LED0高电平输出
  $(document).ready(function(){
    $("#turnonLED0").click(function(){
      $.post("/cp/pullupgpio/LED0",{},function(data,status){
         $("#outputTerminal").text(data +"GPIO4==True"+"\n状態：" + status+"");
      });
    });
  });
  
  //LED0低电平输出
  $(document).ready(function(){
    $("#turnoffLED0").click(function(){
      $.post("/cp/pulldowngpio/LED0",{},function(data,status){
         $("#outputTerminal").text(data +"GPIO4==False"+" \n状態：" + status+"");
      });
    });
  });
  
  //马达控制
  $(document).ready(function(){
    $("#motord1").click(function(){ //马达方向1
      $.post("/cp/motord1",{},function(data,status){
         $("#outputTerminal").text(data +" 状態：" + status);
      });
    });
  });
  
  $(document).ready(function(){
    $("#motord2").click(function(){  //马达方向2
      $.post("/cp/motord2",{},function(data,status){
         $("#outputTerminal").text(data +" 状態：" + status);
      });
    });
  });
  
  $(document).ready(function(){
    $("#motorstop").click(function(){  //马达停止
      $.post("/cp/motorstop",{},function(data,status){
         $("#outputTerminal").text(data +" 状態：" + status);
      });
    });
  });
  
  $(document).ready(function(){
    $("#motorautorun").click(function(){  //自动控制
      var t1=$("#motorrunningT1").val();
      var t2=$("#motorwaitingT2").val();
      var t3=$("#motorrunningT3").val();
      var t4=$("#motorwaitingT4").val();
      var t5=$("#motorrunningT5").val();
      var t6=$("#motorwaitingT6").val();
      var t7=$("#motorrunningT7").val();
      var t8=$("#motorwaitingT8").val();
      if (t1=="" || t2=="" || t3=="" ||t4 =="" || t5 =="" || t6=="" || t7=="" || t8=="" ) {
        $("#outputTerminal").text("T1~T8を全部入れてください。"+"\n"+"-\n-\n");
      }else{
        $("#outputTerminal").text("運転中　t1=" + t1+" t2="+t2+" t3="+t3+" t4="+t4+"\nt5="+t5+" t6="+t6+" t7="+t7+" t8="+t8 +"\n-");
        $.post("/cp/motorautorun/1",{
           "t1":t1,
           "t2":t2,
           "t3":t3,
           "t4":t4,
           "t5":t5,
           "t6":t6,
           "t7":t7,
           "t8":t8
          },function(data,status){
             $("#outputTerminal").text(data +"状態：\n" + status);
                 });
           }
  
          });
  
  
  $("#motorautostop").click(function(){  //马达停止
      $.post("/cp/motorautorun/0",{},function(data,status){
         $("#outputTerminal").text("自動運転完了" + data +" 状態：" + status);
      });
    });
  
  })
  　　 
  
  
  
  
  
  //刷新温度(1秒刷新一次)
  // $(document).ready(function(){
  //   //开始刷新按钮
  //   $("#t_Refresh").click(function(){
  //    var Tcount= setInterval(refreshTemp,2000);
  //   });
  
  //  $("#t_stopRefresh").click(function(){
  //     // clearInterval(Tcount);
  //     $("#outputTerminal").text("停止温度轮询\n \n");
  //   });
  
  //   function refreshTemp(){
  //   $.post("/cp/t_refresh",{},function(data,status){
  //        $("#outputTerminal").text("メソッド：" + "post  戻り値："+data+"度address_adt7410 = 0x48"+" 状態：" + status);
  //        $("#outpuTemperature").html("温度：<b>"+data+"℃</b>");
  //     });
  // }
  // });
  
    //停止刷新按钮
  // $(document).ready(function(){
  
  // });
  
  
  
  </script>
</body>

  </html>